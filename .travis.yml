sudo: required

language: cpp

addons:
  apt:
    sources:
      - george-edison55-precise-backports
    packages:
      - cmake-data
      - cmake

compiler:
  - gcc

matrix:
  include:
  - os: linux
    dist: trusty
    compiler: gcc-4.4
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - nvidia-cuda-dev
          - libcuda1-384
          - build-essential
          - gcc-4.4-multilib
          - gcc-4.4
          - g++-4.4
          - cmake
          - doxygen
    install: ./build_files/build_environment/install_deps.sh --skip-osl --no-confirm
    before_deploy:
      - export RELEASE_FILE=$(ls *.deb)
      - echo "Deploying $RELEASE_FILE to GitHub"
    deploy:
      provider: releases
      api_key:
        secure: "NtEnGek6hZYj3IA8v9WJYhDpP/5K2dl/cLpaxmdNhYbXe6rfeMlIsXYXhEgwd41pE6QOIj8Vyd3d5brh9mQpN8CyGCdwHCT1M8DkH3q2Yq/nH3wqNX8l6kEJoYPfxL1tdAvb16QbI32xdPglkV6gmmWd3Wg/gTn4nt+gdlMJy7b2zi0DKVrIPvoaKQfcfKMLhydhfZqIskV7UvfPYfYmX74z75uLCRethAtZniDKVU2uxJNIuTOBpYQ8kO3ZD/ppVP2hyl+JjX6F411HaRmFlIstm3863h7yg/BuOjZ+ky8Yqxyg9usiHwjQEuxJfmhx5YmAsabCtsoomwM+722Ofucrq2hkkjob4n0iD7ZOyb15/FxTq1B7NxPyEXJwkv0Qi69DOE0bHrAAby+ucAQtp8TpjO/GzGjNdUGwMPwRQ9fGMH8kTFwQgKkeqnNNy4N/RCDOUv6os7ELaXAjzvQKjH8/L8ct+DnQouozrF7SX6OHdehafy4yTOF1UcVq/fHNHLlz3qeIROLLYn5DWOUIPOFqx1XLf62MKMgH1WCIx4pSTQoBIMIJTLEAEgsad4Qlsp/Z7TwfyIPgawj2ljtf0M3jESf7Mel9alvV3fyf79O5/NX5n716tH/XRLvuG4plDGCiCj4r/ilsoZqcMrGnGd5pERd8HfyUO4CpajUoxxg="
      file_glob: true
      file: ${RELEASE_FILE}
      skip_cleanup: true
      on:
        tags: true
        all_branches: true
    env:
      - MATRIX_EVAL="gcc && CXX=g++ && NPROC=$(nproc)"
  - os: linux
    dist: xenial
    compiler: gcc-5
    addons:
      apt:
        sources:
          - ubuntu-toolchain-r-test
        packages:
          - nvidia-cuda-dev
          - libcuda1-384
          - build-essential
          - gcc-5-multilib
          - gcc-5
          - g++-5
          - cmake
          - doxygen
    install: ./build_files/build_environment/install_deps.sh --skip-osl --no-confirm
    before_deploy:
      - export RELEASE_FILE=$(ls *.deb)
      - echo "Deploying $RELEASE_FILE to GitHub"
    deploy:
      provider: releases
      api_key:
        secure: "NtEnGek6hZYj3IA8v9WJYhDpP/5K2dl/cLpaxmdNhYbXe6rfeMlIsXYXhEgwd41pE6QOIj8Vyd3d5brh9mQpN8CyGCdwHCT1M8DkH3q2Yq/nH3wqNX8l6kEJoYPfxL1tdAvb16QbI32xdPglkV6gmmWd3Wg/gTn4nt+gdlMJy7b2zi0DKVrIPvoaKQfcfKMLhydhfZqIskV7UvfPYfYmX74z75uLCRethAtZniDKVU2uxJNIuTOBpYQ8kO3ZD/ppVP2hyl+JjX6F411HaRmFlIstm3863h7yg/BuOjZ+ky8Yqxyg9usiHwjQEuxJfmhx5YmAsabCtsoomwM+722Ofucrq2hkkjob4n0iD7ZOyb15/FxTq1B7NxPyEXJwkv0Qi69DOE0bHrAAby+ucAQtp8TpjO/GzGjNdUGwMPwRQ9fGMH8kTFwQgKkeqnNNy4N/RCDOUv6os7ELaXAjzvQKjH8/L8ct+DnQouozrF7SX6OHdehafy4yTOF1UcVq/fHNHLlz3qeIROLLYn5DWOUIPOFqx1XLf62MKMgH1WCIx4pSTQoBIMIJTLEAEgsad4Qlsp/Z7TwfyIPgawj2ljtf0M3jESf7Mel9alvV3fyf79O5/NX5n716tH/XRLvuG4plDGCiCj4r/ilsoZqcMrGnGd5pERd8HfyUO4CpajUoxxg="
      file_glob: true
      file: ${RELEASE_FILE}
      skip_cleanup: true
      on:
        tags: true
        all_branches: true
    env:
      - MATRIX_EVAL="gcc && CXX=g++ && NPROC=$(nproc)"
  - os: osx
    osx_image: xcode8
    addons:
      apt:
        packages:
          - svn
    install: svn checkout https://svn.blender.org/svnroot/bf-blender/trunk/lib/darwin ../lib/darwin --trust-server-cert --non-interactive
    before_deploy:
      - export RELEASE_FILE=$(ls *.dmg)
      - echo "Deploying $RELEASE_FILE to GitHub"
    deploy:
      provider: releases
      api_key:
        secure: "NtEnGek6hZYj3IA8v9WJYhDpP/5K2dl/cLpaxmdNhYbXe6rfeMlIsXYXhEgwd41pE6QOIj8Vyd3d5brh9mQpN8CyGCdwHCT1M8DkH3q2Yq/nH3wqNX8l6kEJoYPfxL1tdAvb16QbI32xdPglkV6gmmWd3Wg/gTn4nt+gdlMJy7b2zi0DKVrIPvoaKQfcfKMLhydhfZqIskV7UvfPYfYmX74z75uLCRethAtZniDKVU2uxJNIuTOBpYQ8kO3ZD/ppVP2hyl+JjX6F411HaRmFlIstm3863h7yg/BuOjZ+ky8Yqxyg9usiHwjQEuxJfmhx5YmAsabCtsoomwM+722Ofucrq2hkkjob4n0iD7ZOyb15/FxTq1B7NxPyEXJwkv0Qi69DOE0bHrAAby+ucAQtp8TpjO/GzGjNdUGwMPwRQ9fGMH8kTFwQgKkeqnNNy4N/RCDOUv6os7ELaXAjzvQKjH8/L8ct+DnQouozrF7SX6OHdehafy4yTOF1UcVq/fHNHLlz3qeIROLLYn5DWOUIPOFqx1XLf62MKMgH1WCIx4pSTQoBIMIJTLEAEgsad4Qlsp/Z7TwfyIPgawj2ljtf0M3jESf7Mel9alvV3fyf79O5/NX5n716tH/XRLvuG4plDGCiCj4r/ilsoZqcMrGnGd5pERd8HfyUO4CpajUoxxg="
      file_glob: true
      file: ${RELEASE_FILE}
      skip_cleanup: true
      on:
        tags: true
        all_branches: true
    env:
      - MATRIX_EVAL="NPROC=$(sysctl -n hw.physicalcpu)"

script:
  - mkdir build
  - cd build
  - cmake -DCPACK_BINARY_DEB:BOOL=True .. && make install && make package
